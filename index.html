<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û - ‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 4</title>
  <!-- CDN libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Sarabun', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .upload-area { border: 3px dashed #cbd5e0; transition: all 0.3s ease; }
    .upload-area:hover { border-color: #4299e1; background-color: #ebf8ff; }
    .upload-area.dragover { border-color: #3182ce; background-color: #bee3f8; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="gradient-bg text-white py-6 shadow-lg">
    <div class="container mx-auto px-6">
      <h1 class="text-3xl font-bold text-center">üè• Dashboard ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h1>
      <p class="text-center text-blue-100 mt-2 text-lg">‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 4 ‡πÇ‡∏î‡∏¢ ‡∏ó‡∏µ‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏π‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå (Situation Awareness Team: SAT)</p>
      <div class="text-center mt-4 text-blue-100">
        <p id="dataDateRange" class="text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span id="startDate">-</span> ‡∏ñ‡∏∂‡∏á <span id="endDate">-</span></p>
        <p class="text-xs mt-1">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° M-EBS ‡∏Å‡∏£‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ</p>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-6 py-8">
    <!-- Summary Cards -->
    <div id="summaryCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 rounded-xl p-6 text-white card-shadow transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-100 text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <p id="totalEvents" class="text-3xl font-bold">-</p>
          </div>
          <div class="text-5xl opacity-80">üìä</div>
        </div>
      </div>
      <div class="bg-gradient-to-br from-emerald-500 via-green-600 to-teal-700 rounded-xl p-6 text-white card-shadow transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-100 text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏ß‡∏°</p>
            <p id="totalCases" class="text-3xl font-bold">-</p>
          </div>
          <div class="text-5xl opacity-80">üë•</div>
        </div>
      </div>
      <div class="bg-gradient-to-br from-red-500 via-rose-600 to-pink-700 rounded-xl p-6 text-white card-shadow transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-red-100 text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</p>
            <p id="totalDeaths" class="text-3xl font-bold">-</p>
          </div>
          <div class="text-5xl opacity-80">‚ö†Ô∏è</div>
        </div>
      </div>
      <div class="bg-gradient-to-br from-purple-500 via-violet-600 to-indigo-700 rounded-xl p-6 text-white card-shadow transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-purple-100 text-sm font-medium">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</p>
            <p id="totalProvinces" class="text-3xl font-bold">-</p>
          </div>
          <div class="text-5xl opacity-80">üìç</div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div id="chartsSection">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <div class="bg-white rounded-xl card-shadow p-8 border-l-4 border-indigo-500">
          <div class="flex items-center mb-6">
            <div class="bg-indigo-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div class="flex-1">
              <h3 id="eventGroupTitle" class="text-xl font-semibold text-gray-800">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
              <p class="text-gray-600 text-sm">‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏£‡∏Ñ</p>
            </div>
          </div>
          <div class="h-96"><canvas id="eventGroupPieChart"></canvas></div>
        </div>

        <div class="bg-white rounded-xl card-shadow p-8 border-l-4 border-blue-500">
          <div class="flex items-center mb-6">
            <div class="bg-blue-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
            </div>
            <div class="flex-1">
              <h3 id="eventListTitle" class="text-xl font-semibold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
              <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö</p>
            </div>
          </div>
          <div class="h-96 overflow-y-auto"><div id="eventListTable"></div></div>
        </div>
      </div>

      <!-- Province Chart -->
      <div class="bg-white rounded-xl card-shadow p-8 mb-8 border-l-4 border-green-500">
        <div class="flex items-center mb-6">
          <div class="bg-green-100 p-3 rounded-lg mr-4">
            <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <h3 id="provinceTitle" class="text-xl font-semibold text-gray-800">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
            <p class="text-gray-600 text-sm">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å</p>
          </div>
        </div>
        <div class="h-96"><canvas id="provinceChart"></canvas></div>
      </div>

      <!-- Timeline Chart -->
      <div class="bg-white rounded-xl card-shadow p-8 mb-8 border-l-4 border-purple-500">
        <div class="flex items-center mb-6">
          <div class="bg-purple-100 p-3 rounded-lg mr-4">
            <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <h3 id="timelineTitle" class="text-xl font-semibold text-gray-800">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤</h3>
            <p class="text-gray-600 text-sm">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
          </div>
        </div>
        <div class="h-96"><canvas id="timelineChart"></canvas></div>
      </div>

      <!-- Priority & Status Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white rounded-xl card-shadow p-8 border-l-4 border-orange-500">
          <div class="flex items-center mb-6">
            <div class="bg-orange-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div class="flex-1">
              <h3 id="priorityTitle" class="text-xl font-semibold text-gray-800">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πà‡∏≤‡∏ß</h3>
              <p class="text-gray-600 text-sm">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</p>
            </div>
          </div>
          <div class="h-80"><canvas id="priorityChart"></canvas></div>
        </div>

        <div class="bg-white rounded-xl card-shadow p-8 border-l-4 border-teal-500">
          <div class="flex items-center mb-6">
            <div class="bg-teal-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-teal-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
            </div>
            <div class="flex-1">
              <h3 id="statusTitle" class="text-xl font-semibold text-gray-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</h3>
              <p class="text-gray-600 text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
            </div>
          </div>
          <div class="h-80"><canvas id="statusChart"></canvas></div>
        </div>
      </div>
    </div>

    <!-- Data Table -->
    <div id="dataTableSection" class="bg-white rounded-xl card-shadow p-8 mt-8 border-l-4 border-gray-500">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <div class="bg-gray-100 p-3 rounded-lg mr-4">
            <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
            <p class="text-gray-600 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÅ‡∏™‡∏î‡∏á 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</p>
          </div>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table id="dataTable" class="min-w-full table-auto">
          <thead class="bg-gray-50"><tr id="tableHeader"></tr></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Upload Section (Dropdown) -->
    <div class="mt-8">
      <div class="bg-white rounded-xl card-shadow border-l-4 border-indigo-500 overflow-hidden">
        <button id="uploadToggle" class="w-full p-6 text-left hover:bg-gray-50 transition-colors flex items-center justify-between">
          <div class="flex items-center">
            <div class="bg-indigo-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-semibold text-gray-800">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÉ‡∏´‡∏°‡πà</h2>
              <p class="text-gray-600 text-sm">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</p>
            </div>
          </div>
          <svg id="uploadArrow" class="w-6 h-6 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>

        <div id="uploadContent" class="hidden border-t border-gray-200 p-8">
          <!-- Authentication Form -->
          <div id="authForm" class="mb-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
              <div class="flex items-center">
                <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                </svg>
                <p class="text-yellow-800 font-medium">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Username" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Password" />
              </div>
            </div>
            <button id="authBtn" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</button>
            <div id="authError" class="hidden mt-2 text-red-600 text-sm"></div>
          </div>

          <!-- Date Range Form -->
          <div id="dateRangeForm" class="mb-6 hidden">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
              <div class="flex items-center mb-3">
                <svg class="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
                <p class="text-blue-800 font-medium">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                  <input type="date" id="customStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                  <input type="date" id="customEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                </div>
              </div>
              <button id="updateDateBtn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
            </div>
          </div>

          <!-- Upload Area (Hidden initially) -->
          <div id="uploadArea" class="upload-area rounded-lg p-12 text-center cursor-pointer hidden">
            <div class="flex flex-col items-center">
              <svg class="w-16 h-16 text-indigo-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <p class="text-xl text-gray-600 mb-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
              <p class="text-gray-400">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÅ‡∏•‡∏∞ .xls</p>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden" />
          </div>

          <div id="fileInfo" class="mt-4 hidden">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
              <p class="text-green-800 font-medium">‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î: <span id="fileName"></span></p>
              <p class="text-green-600 text-sm mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <span id="rowCount"></span> ‡πÅ‡∏ñ‡∏ß</p>
            </div>
          </div>

          <!-- NEW: ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JSON ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô repo/data/data.json -->
          <button id="downloadJsonBtn" class="mt-4 bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium hidden">
            ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå JSON (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô data/data.json)
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let chartInstances = {};
    let currentData = [];
    let fixedDateRange = null;

    // Elements
    const uploadToggle   = document.getElementById('uploadToggle');
    const uploadContent  = document.getElementById('uploadContent');
    const uploadArrow    = document.getElementById('uploadArrow');
    const uploadArea     = document.getElementById('uploadArea');
    const fileInput      = document.getElementById('fileInput');
    const fileInfo       = document.getElementById('fileInfo');
    const authBtn        = document.getElementById('authBtn');
    const authForm       = document.getElementById('authForm');
    const authError      = document.getElementById('authError');
    const downloadBtn    = document.getElementById('downloadJsonBtn');
    let isAuthenticated  = false;

    // Toggle upload section
    uploadToggle.addEventListener('click', () => {
      uploadContent.classList.toggle('hidden');
      uploadArrow.classList.toggle('rotate-180');
    });

    // Authentication handling (client-side only)
    authBtn.addEventListener('click', () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      if (username === 'SAT Manager' && password === 'odpc004999') {
        isAuthenticated = true;
        authForm.classList.add('hidden');
        document.getElementById('dateRangeForm').classList.remove('hidden');
        uploadArea.classList.remove('hidden');
        authError.classList.add('hidden');
        document.getElementById('fileInfo').classList.add('hidden');
        // show download json button after auth
        downloadBtn.classList.remove('hidden');
      } else {
        authError.textContent = 'Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        authError.classList.remove('hidden');
      }
    });

    // Enter key support for authentication
    document.getElementById('password').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') authBtn.click();
    });

    // Date range update handling
    document.getElementById('updateDateBtn').addEventListener('click', () => {
      const startDate = document.getElementById('customStartDate').value;
      const endDate   = document.getElementById('customEndDate').value;
      if (startDate && endDate) {
        updateCustomDateRange(startDate, endDate);
        localStorage.setItem('customStartDate', startDate);
        localStorage.setItem('customEndDate',   endDate);
      } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
      }
    });

    // NEW: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≤‡∏Å data/data.json ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
    async function loadSharedData() {
      try {
        const res = await fetch('./data/data.json?ts=' + Date.now(), { cache: 'no-store' });
        if (!res.ok) return false;
        const json = await res.json();
        if (Array.isArray(json)) {
          currentData = json;
          processData(json);
          return true;
        }
      } catch (e) { console.error('loadSharedData error', e); }
      return false;
    }

    document.addEventListener('DOMContentLoaded', async function () {
      // 1) ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≤‡∏Å repo ‡∏Å‡πà‡∏≠‡∏ô
      const ok = await loadSharedData();

      // 2) ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
      const storedStartDate = localStorage.getItem('customStartDate');
      const storedEndDate   = localStorage.getItem('customEndDate');
      if (storedStartDate && storedEndDate) {
        document.getElementById('customStartDate').value = storedStartDate;
        document.getElementById('customEndDate').value   = storedEndDate;
        updateCustomDateRange(storedStartDate, storedEndDate);
      }

      // 3) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ data.json ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ localStorage ‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá sample
      if (!ok) {
        const storedData = localStorage.getItem('uploadedData');
        if (storedData) {
          try {
            const parsedData = JSON.parse(storedData);
            currentData = parsedData;
            processData(parsedData);
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï UI ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏°‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            isAuthenticated = false;
            authForm.classList.remove('hidden');
            document.getElementById('dateRangeForm').classList.add('hidden');
            uploadArea.classList.add('hidden');
            document.getElementById('fileInfo').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('authError').classList.add('hidden');
          } catch (e) {
            console.error('Error loading stored data:', e);
            initializeSampleData();
          }
        } else {
          initializeSampleData();
        }
      }
    });

    // Upload handlers
    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files; if (files.length > 0) handleFile(files[0]);
    });
    fileInput.addEventListener('change', (e) => { if (e.target.files.length > 0) handleFile(e.target.files[0]); });

    function handleFile(file) {
      if (!isAuthenticated) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå'); return; }
      if (!file.name.match(/\.(xlsx|xls)$/)) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx ‡∏´‡∏£‡∏∑‡∏≠ .xls)'); return; }

      document.getElementById('fileName').textContent = file.name;
      fileInfo.classList.remove('hidden');

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet);

        document.getElementById('rowCount').textContent = jsonData.length;
        currentData = jsonData;

        // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        localStorage.setItem('uploadedData', JSON.stringify(jsonData));

        processData(jsonData);

        // ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ã‡πà‡∏≠‡∏ô accordion ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤ repo
        uploadContent.classList.add('hidden');
        uploadArrow.classList.remove('rotate-180');
        downloadBtn.classList.remove('hidden');
      };
      reader.readAsArrayBuffer(file);
    }

    // NEW: ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JSON ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤ repo/data/data.json
    function downloadJSON() {
      const blob = new Blob([JSON.stringify(currentData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'data.json'; a.click();
      URL.revokeObjectURL(url);
    }
    downloadBtn.addEventListener('click', downloadJSON);

    // =======================
    // Data processing helpers
    // =======================

    function initializeSampleData() {
      const sampleData = [
        {Event_ID:'E001',Event_Group:'‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡πÑ‡∏Ç‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å',Province_Name:'‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å',Place_Type:'‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',Date_Received:'04-01-2567',Onset:'02-01-2567',case:25,Death:0,Priority:'‡∏™‡∏π‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E002',Event_Group:'‡πÇ‡∏£‡∏Ñ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©',Province_Name:'‡∏•‡∏≥‡∏õ‡∏≤‡∏á',District_Name:'‡πÄ‡∏Å‡∏≤‡∏∞‡∏Ñ‡∏≤',Subdistrict_Name:'‡πÄ‡∏Å‡∏≤‡∏∞‡∏Ñ‡∏≤',Place_Type:'‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£',Date_Received:'20-02-2567',Onset:'18-02-2567',case:12,Death:1,Priority:'‡∏Å‡∏•‡∏≤‡∏á',Status:'‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',Investigation:'‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß'},
        {Event_ID:'E003',Event_Group:'‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',Event_list:'‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏£‡∏≤‡∏à‡∏£',Province_Name:'‡∏•‡∏≥‡∏û‡∏π‡∏ô',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡∏ô‡∏≤‡∏¢‡∏°',Place_Type:'‡∏ñ‡∏ô‡∏ô',Date_Received:'10-03-2567',Onset:'10-03-2567',case:8,Death:2,Priority:'‡∏™‡∏π‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E004',Event_Group:'‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡πÇ‡∏Ñ‡∏ß‡∏¥‡∏î-19',Province_Name:'‡πÅ‡∏û‡∏£‡πà',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡πÉ‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏á',Place_Type:'‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•',Date_Received:'05-04-2567',Onset:'02-04-2567',case:45,Death:3,Priority:'‡∏™‡∏π‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E005',Event_Group:'‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°',Event_list:'‡∏°‡∏•‡∏û‡∏¥‡∏©‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®',Province_Name:'‡∏ô‡πà‡∏≤‡∏ô',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡πÉ‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏á',Place_Type:'‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô',Date_Received:'12-05-2567',Onset:'10-05-2567',case:30,Death:0,Priority:'‡∏Å‡∏•‡∏≤‡∏á',Status:'‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E006',Event_Group:'‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡∏°‡∏∑‡∏≠‡πÄ‡∏ó‡πâ‡∏≤‡∏õ‡∏≤‡∏Å',Province_Name:'‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡∏£‡∏≠‡∏ö‡πÄ‡∏ß‡∏µ‡∏¢‡∏á',Place_Type:'‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å',Date_Received:'18-06-2567',Onset:'15-06-2567',case:18,Death:0,Priority:'‡∏Å‡∏•‡∏≤‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E007',Event_Group:'‡πÇ‡∏£‡∏Ñ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡∏û‡∏¥‡∏©‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ',Province_Name:'‡∏û‡∏∞‡πÄ‡∏¢‡∏≤',District_Name:'‡πÄ‡∏°‡∏∑‡∏≠‡∏á',Subdistrict_Name:'‡πÄ‡∏ß‡∏µ‡∏¢‡∏á',Place_Type:'‡∏ä‡∏∏‡∏°‡∏ä‡∏ô',Date_Received:'22-07-2567',Onset:'20-07-2567',case:15,Death:1,Priority:'‡∏™‡∏π‡∏á',Status:'‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',Investigation:'‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß'},
        {Event_ID:'E008',Event_Group:'‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',Event_list:'‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ',Province_Name:'‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà',District_Name:'‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢',Subdistrict_Name:'‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢',Place_Type:'‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô',Date_Received:'14-08-2567',Onset:'14-08-2567',case:22,Death:4,Priority:'‡∏™‡∏π‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E009',Event_Group:'‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',Event_list:'‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà',Province_Name:'‡∏•‡∏≥‡∏õ‡∏≤‡∏á',District_Name:'‡πÅ‡∏°‡πà‡πÄ‡∏°‡∏≤‡∏∞',Subdistrict_Name:'‡πÅ‡∏°‡πà‡πÄ‡∏°‡∏≤‡∏∞',Place_Type:'‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',Date_Received:'08-09-2567',Onset:'05-09-2567',case:35,Death:0,Priority:'‡∏Å‡∏•‡∏≤‡∏á',Status:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'},
        {Event_ID:'E010',Event_Group:'‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°',Event_list:'‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢',Province_Name:'‡∏•‡∏≥‡∏û‡∏π‡∏ô',District_Name:'‡∏õ‡πà‡∏≤‡∏ã‡∏≤‡∏á',Subdistrict_Name:'‡∏õ‡πà‡∏≤‡∏ã‡∏≤‡∏á',Place_Type:'‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ô‡πâ‡∏≥',Date_Received:'06-12-2567',Onset:'04-12-2567',case:28,Death:0,Priority:'‡∏Å‡∏•‡∏≤‡∏á',Status:'‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',Investigation:'‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô'}
      ];
      currentData = sampleData;
      processData(sampleData);
    }

    function processData(data) {
      const totalEvents = data.length;
      const totalCases  = data.reduce((s, r) => s + (parseInt(r.case) || 0), 0);
      const totalDeaths = data.reduce((s, r) => s + (parseInt(r.Death) || 0), 0);
      const uniqueProvinces = [...new Set(data.map(r => r.Province_Name))].length;
      document.getElementById('totalEvents').textContent   = totalEvents.toLocaleString();
      document.getElementById('totalCases').textContent    = totalCases.toLocaleString();
      document.getElementById('totalDeaths').textContent   = totalDeaths.toLocaleString();
      document.getElementById('totalProvinces').textContent= uniqueProvinces;

      updateDateRange(data);
      createEventListTable(data);
      createEventGroupPieChart(data);
      createProvinceChart(data);
      createTimelineChart(data);
      createPriorityChart(data);
      createStatusChart(data);
      createDataTable(data);
    }

    function updateDateRange(data) {
      if (fixedDateRange) {
        document.getElementById('startDate').textContent = fixedDateRange.start;
        document.getElementById('endDate').textContent   = fixedDateRange.end; return;
      }
      function parseThaiDate(dateStr) {
        if (!dateStr) return null; let d, m, y;
        if (dateStr.includes('-')) { const p = dateStr.split('-'); if (p.length===3){ d=+p[0]; m=+p[1]; y=+p[2]; if (y>2500) y-=543; return new Date(y,m-1,d);} }
        if (dateStr.includes('/')) { const p = dateStr.split('/'); if (p.length===3){ d=+p[0]; m=+p[1]; y=+p[2]; if (y>2500) y-=543; return new Date(y,m-1,d);} }
        const dt = new Date(dateStr); return isNaN(dt) ? null : dt;
      }
      const dates = data.map(r => parseThaiDate(r.Date_Received)).filter(dt => dt && !isNaN(dt));
      if (dates.length>0){
        const minDate = new Date(Math.min(...dates));
        const maxDate = new Date(Math.max(...dates));
        const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
        const fmt = d => `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()+543}`;
        const startText = fmt(minDate); const endText = fmt(maxDate);
        fixedDateRange = { start: startText, end: endText };
        document.getElementById('startDate').textContent = startText;
        document.getElementById('endDate').textContent   = endText;
      }
    }

    function updateCustomDateRange(startDateStr, endDateStr) {
      const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
      const fmt = s => { const d=new Date(s); return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()+543}`; };
      fixedDateRange = { start: fmt(startDateStr), end: fmt(endDateStr) };
      document.getElementById('startDate').textContent = fixedDateRange.start;
      document.getElementById('endDate').textContent   = fixedDateRange.end;
    }

    function createEventListTable(data) {
      const counts = {}; data.forEach(r => { const e=r.Event_list||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; counts[e]=(counts[e]||0)+1; });
      const total = Object.values(counts).reduce((s,c)=>s+c,0);
      const sorted = Object.entries(counts).sort(([,a],[,b])=>b-a);
      const maxCount = Math.max(...sorted.map(([,c])=>c));
      document.getElementById('eventListTitle').textContent = `‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (N= ${total})`;
      const container = document.getElementById('eventListTable');
      let html = `<table class="min-w-full"><thead class="bg-gray-50"><tr>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</th>
        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</th>
        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞</th>
      </tr></thead><tbody class="bg-white divide-y divide-gray-200">`;
      sorted.forEach(([name,count], i) => {
        const pct = ((count/total)*100).toFixed(1);
        const intensity = count/maxCount; const g = Math.round(255-(intensity*100));
        const bg = `rgba(34, ${g}, 34, ${0.1 + (intensity*0.4)})`;
        html += `<tr style="background-color:${bg}">
          <td class="px-4 py-3 text-sm text-gray-900 font-medium">${i+1}</td>
          <td class="px-4 py-3 text-sm text-gray-900">${name}</td>
          <td class="px-4 py-3 text-sm text-gray-900 text-center font-bold">${count.toLocaleString()}</td>
          <td class="px-4 py-3 text-sm text-gray-900 text-center font-medium">${pct}%</td>
        </tr>`;
      });
      html += `<tr class="bg-blue-50 border-t-2 border-blue-200">
        <td class="px-4 py-3 text-sm font-bold text-blue-900" colspan="2">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
        <td class="px-4 py-3 text-sm font-bold text-blue-900 text-center">${total.toLocaleString()}</td>
        <td class="px-4 py-3 text-sm font-bold text-blue-900 text-center">100.0%</td>
      </tr></tbody></table>`;
      container.innerHTML = html;
    }

    function createEventGroupPieChart(data) {
      const groupCounts = {}; data.forEach(r => { const g=r.Event_Group||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; groupCounts[g]=(groupCounts[g]||0)+1; });
      const total = Object.values(groupCounts).reduce((s,c)=>s+c,0);
      const sorted = Object.entries(groupCounts).sort(([,a],[,b])=>b-a);
      document.getElementById('eventGroupTitle').textContent = `‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (N= ${total})`;
      const ctx = document.getElementById('eventGroupPieChart').getContext('2d');
      if (chartInstances.eventGroupPie) chartInstances.eventGroupPie.destroy();
      chartInstances.eventGroupPie = new Chart(ctx, {
        type: 'pie',
        data: { labels: sorted.map(([n])=>n), datasets:[{ data: sorted.map(([,c])=>c), backgroundColor:[
          'rgba(59, 130, 246, 0.8)','rgba(16, 185, 129, 0.8)','rgba(245, 101, 101, 0.8)','rgba(139, 92, 246, 0.8)','rgba(251, 191, 36, 0.8)','rgba(236, 72, 153, 0.8)','rgba(20, 184, 166, 0.8)','rgba(249, 115, 22, 0.8)','rgba(107, 114, 128, 0.8)','rgba(34, 197, 94, 0.8)'
        ], borderColor:'#fff', borderWidth:3 }]},
        options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom', labels:{ font:{family:'Sarabun',size:12}, padding:15, usePointStyle:true, pointStyle:'circle' }}, tooltip:{ callbacks:{ label:(ctx)=>{ const c=ctx.parsed; const p=((c/total)*100).toFixed(1); return `${ctx.label}: ${c.toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${p}%)`; } }, titleFont:{family:'Sarabun',size:14}, bodyFont:{family:'Sarabun',size:13} } } }
      });
    }

    function createProvinceChart(data) {
      const provinceCounts = {}; data.forEach(r=>{ const p=r.Province_Name||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; provinceCounts[p]=(provinceCounts[p]||0)+1; });
      const total = Object.values(provinceCounts).reduce((s,c)=>s+c,0);
      const sorted = Object.entries(provinceCounts).sort(([,a],[,b])=>b-a).slice(0,10);
      document.getElementById('provinceTitle').textContent = `‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (N= ${total})`;
      const ctx = document.getElementById('provinceChart').getContext('2d');
      if (chartInstances.province) chartInstances.province.destroy();
      chartInstances.province = new Chart(ctx, {
        type:'bar', data:{ labels: sorted.map(([n])=>n), datasets:[{ label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå', data: sorted.map(([,c])=>c), backgroundColor:'rgba(16, 185, 129, 0.8)', borderColor:'rgba(16, 185, 129, 1)', borderWidth:2, borderRadius:8, borderSkipped:false }]},
        options:{ indexAxis:'y', responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, tooltip:{ callbacks:{ label:(ctx)=>{ const c=ctx.parsed.x; const p=((c/total)*100).toFixed(1); return `${ctx.label}: ${c.toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${p}%)`; } }, titleFont:{family:'Sarabun',size:14}, bodyFont:{family:'Sarabun',size:13} } }, scales:{ x:{ beginAtZero:true, ticks:{ font:{family:'Sarabun',size:12}, callback:(v)=>v.toLocaleString() }, grid:{ color:'rgba(0,0,0,0.1)'} }, y:{ ticks:{ font:{family:'Sarabun',size:12} }, grid:{ display:false } } } }
      });
    }

    function createTimelineChart(data) {
      const monthCounts = {}; let minY=Infinity, maxY=-Infinity;
      function parseThaiDate(s){ if(!s) return null; let d,m,y; if(s.includes('-')){const p=s.split('-'); if(p.length===3){d=+p[0]; m=+p[1]; y=+p[2]; if(y>2500) y-=543; return new Date(y,m-1,d);} } if(s.includes('/')){const p=s.split('/'); if(p.length===3){d=+p[0]; m=+p[1]; y=+p[2]; if(y>2500) y-=543; return new Date(y,m-1,d);} } const dt=new Date(s); return isNaN(dt)?null:dt; }
      data.forEach(r=>{ if(r.Date_Received){ const dt=parseThaiDate(r.Date_Received); if(dt && !isNaN(dt)){ const y=dt.getFullYear(); minY=Math.min(minY,y); maxY=Math.max(maxY,y); const key=`${y}-${String(dt.getMonth()+1).padStart(2,'0')}`; monthCounts[key]=(monthCounts[key]||0)+1; } } });
      const allMonths=[]; if(minY!==Infinity && maxY!==-Infinity){ for(let y=minY; y<=maxY; y++){ for(let m=1; m<=12; m++){ const k=`${y}-${String(m).padStart(2,'0')}`; allMonths.push(k); if(!monthCounts[k]) monthCounts[k]=0; } } }
      const total = data.length; document.getElementById('timelineTitle').textContent = `‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (N= ${total})`;
      const sorted = allMonths.sort().map(k=>[k, monthCounts[k]||0]);
      const labels = sorted.map(([k])=>{ const [y,m]=k.split('-'); const names=['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.']; return `${names[+m-1]} ${y}`; });
      const dataPts = sorted.map(([k,c],i)=>({x:i,y:c}));
      const ctx = document.getElementById('timelineChart').getContext('2d');
      if (chartInstances.timeline) chartInstances.timeline.destroy();
      chartInstances.timeline = new Chart(ctx, { type:'line', data:{ labels, datasets:[{ label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', data:dataPts, borderColor:'rgba(139, 92, 246, 1)', backgroundColor:'rgba(139, 92, 246, 0.1)', borderWidth:4, fill:true, tension:0.4, pointBackgroundColor:(c)=> c.parsed.y===0?'rgba(139,92,246,0.4)':'rgba(139,92,246,1)', pointBorderColor:'#fff', pointBorderWidth:3, pointRadius:(c)=> c.parsed.y===0?4:6, pointHoverRadius:8, segment:{ borderDash:(ctx)=>{ const p0=ctx.p0.parsed.y, p1=ctx.p1.parsed.y; return (p0===0 && p1===0)?[8,8]:undefined; }, borderColor:(ctx)=>{ const p0=ctx.p0.parsed.y, p1=ctx.p1.parsed.y; return (p0===0 && p1===0)?'rgba(139,92,246,0.4)':'rgba(139,92,246,1)'; } }, spanGaps:true }]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, tooltip:{ callbacks:{ label:(ctx)=>`${ctx.label}: ${ctx.parsed.y} ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå` }, titleFont:{family:'Sarabun',size:14}, bodyFont:{family:'Sarabun',size:13} } }, scales:{ y:{ beginAtZero:true, ticks:{ font:{family:'Sarabun',size:12}, stepSize:1, callback:(v)=>Number.isInteger(v)?v:'' }, grid:{ color:'rgba(0,0,0,0.1)'} }, x:{ ticks:{ font:{family:'Sarabun',size:12}, maxRotation:45 }, grid:{ color:'rgba(0,0,0,0.05)'} } } } });
    }

    function createPriorityChart(data) {
      const counts = {}; data.forEach(r=>{ const k=r.Priority||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; counts[k]=(counts[k]||0)+1; });
      const total = Object.values(counts).reduce((s,c)=>s+c,0);
      const sorted = Object.entries(counts).sort(([,a],[,b])=>b-a);
      document.getElementById('priorityTitle').textContent = `‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πà‡∏≤‡∏ß (N= ${total})`;
      const colorMap = { '‡∏™‡∏π‡∏á':'rgba(239, 68, 68, 0.8)', '‡∏Å‡∏•‡∏≤‡∏á':'rgba(245, 158, 11, 0.8)', '‡∏ï‡πà‡∏≥':'rgba(34, 197, 94, 0.8)', '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏':'rgba(156, 163, 175, 0.8)' };
      const ctx = document.getElementById('priorityChart').getContext('2d');
      if (chartInstances.priority) chartInstances.priority.destroy();
      chartInstances.priority = new Chart(ctx, { type:'bar', data:{ labels: sorted.map(()=> '‚óè'), datasets:[{ label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå', data: sorted.map(([,c])=>c), backgroundColor: sorted.map(([n])=>colorMap[n]||'rgba(59,130,246,0.8)'), borderColor: sorted.map(([n])=>(colorMap[n]||'rgba(59,130,246,0.8)').replace('0.8','1')), borderWidth:2, borderRadius:8, borderSkipped:false }]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:true, position:'bottom', labels:{ generateLabels:()=> sorted.map(([n],i)=>({ text:`${n} (${sorted[i][1]} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)`, fillStyle: colorMap[n]||'rgba(59,130,246,0.8)', strokeStyle:(colorMap[n]||'rgba(59,130,246,0.8)').replace('0.8','1'), lineWidth:2, pointStyle:'rect' }), font:{family:'Sarabun',size:12}, padding:15, usePointStyle:true } }, tooltip:{ callbacks:{ title:(ctx)=> sorted[ctx[0].dataIndex][0], label:(ctx)=>{ const c=ctx.parsed.y; const p=((c/total)*100).toFixed(1); return `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${c.toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${p}%)`; } }, titleFont:{family:'Sarabun',size:14}, bodyFont:{family:'Sarabun',size:13} } }, scales:{ y:{ beginAtZero:true, ticks:{ font:{family:'Sarabun',size:12}, callback:(v)=>v.toLocaleString() }, grid:{ color:'rgba(0,0,0,0.1)' } }, x:{ ticks:{ font:{family:'Sarabun',size:16,weight:'bold'}, color:(ctx)=>{ const n=sorted[ctx.index][0]; const c=colorMap[n]||'rgba(59,130,246,1)'; return c.replace('0.8','1'); } }, grid:{ display:false } } } });
    }

    function createStatusChart(data) {
      const counts = {}; data.forEach(r=>{ const k=r.Status||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; counts[k]=(counts[k]||0)+1; });
      const total = Object.values(counts).reduce((s,c)=>s+c,0);
      const sorted = Object.entries(counts).sort(([,a],[,b])=>b-a);
      document.getElementById('statusTitle').textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (N= ${total})`;
      const ctx = document.getElementById('statusChart').getContext('2d');
      if (chartInstances.status) chartInstances.status.destroy();
      chartInstances.status = new Chart(ctx, { type:'bar', data:{ labels: sorted.map(([n])=>n), datasets:[{ label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå', data: sorted.map(([,c])=>c), backgroundColor:['rgba(20, 184, 166, 0.8)','rgba(251, 191, 36, 0.8)','rgba(239, 68, 68, 0.8)','rgba(139, 92, 246, 0.8)','rgba(156, 163, 175, 0.8)'], borderColor:['rgba(20, 184, 166, 1)','rgba(251, 191, 36, 1)','rgba(239, 68, 68, 1)','rgba(139, 92, 246, 1)','rgba(156, 163, 175, 1)'], borderWidth:2, borderRadius:8, borderSkipped:false }]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, tooltip:{ callbacks:{ label:(ctx)=>{ const c=ctx.parsed.y; const p=((c/total)*100).toFixed(1); return `${ctx.label}: ${c.toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${p}%)`; } }, titleFont:{family:'Sarabun',size:14}, bodyFont:{family:'Sarabun',size:13} } }, scales:{ y:{ beginAtZero:true, ticks:{ font:{family:'Sarabun',size:12}, callback:(v)=>v.toLocaleString() }, grid:{ color:'rgba(0,0,0,0.1)' } }, x:{ ticks:{ font:{family:'Sarabun',size:12}, maxRotation:45 }, grid:{ display:false } } } });
    }

    function createDataTable(data) {
      const header = document.getElementById('tableHeader');
      const body   = document.getElementById('tableBody');
      header.innerHTML = ''; body.innerHTML = '';
      if (!data.length) return;
      const cols = Object.keys(data[0]);
      cols.forEach(c => { const th=document.createElement('th'); th.className='px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b'; th.textContent=c; header.appendChild(th); });
      data.slice(-10).reverse().forEach((row,i)=>{ const tr=document.createElement('tr'); tr.className = i%2===0 ? 'bg-white' : 'bg-gray-50'; cols.forEach(c=>{ const td=document.createElement('td'); td.className='px-4 py-3 text-sm text-gray-900 border-b'; td.textContent = row[c] ?? '-'; tr.appendChild(td); }); body.appendChild(tr); });
      if (data.length>10){ const tr=document.createElement('tr'); const td=document.createElement('td'); td.colSpan=cols.length; td.className='px-4 py-3 text-center text-sm text-gray-500 italic'; td.textContent=`‡πÅ‡∏™‡∏î‡∏á 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${data.length} ‡πÅ‡∏ñ‡∏ß`; tr.appendChild(td); body.appendChild(tr); }
    }
  </script>
  <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå Cloudflare /cdn-cgi ‡∏ó‡∏µ‡πà‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö GitHub Pages ‡πÑ‡∏î‡πâ -->
</body>
</html>
